# Stage 03: UX Design

## AGENT-NATIVE EXECUTION
You are Claude executing Stage 03 for a SPECIFIC IDEA PACK. Design comprehensive user experience based on product specifications and current UX standards.

## BUILD MODE VERIFICATION (CRITICAL)
Stage 03 can ONLY be executed via `build <IDEA_ID_OR_NAME>` command:
- Verify invocation came from build mode, not `run app factory`
- Require Stage 01-02 artifacts exist (hard-fail if missing)
- Assert this stage is building ONE SPECIFIC IDEA only
- Hard-fail if executed during batch idea generation

## STANDARDS CONTRACT (MANDATORY)
Read and comply with `standards/mobile_app_best_practices_2026.md`. Your output must include a "Standards Compliance Mapping" section demonstrating accessibility and design system requirements.

## INPUTS
- Read: `runs/.../ideas/<idea_dir>/stages/stage02.json` (product specification)
- Read: `runs/.../ideas/<idea_dir>/meta/idea.json` (canonical idea definition)
- Read: `runs/.../ideas/<idea_dir>/meta/boundary.json` (isolation enforcement)

## OUTPUTS
- Write: `runs/.../ideas/<idea_dir>/stages/stage03.json` (validated UX specification)
- Write: `runs/.../ideas/<idea_dir>/outputs/stage03_execution.md` (execution log with decisions)
- Write: `runs/.../ideas/<idea_dir>/outputs/stage03_research.md` (UX research citations)
- Render: `runs/.../ideas/<idea_dir>/spec/03_ux_design.md` (specification markdown)
- **Write: `runs/.../ideas/<idea_dir>/uiux/uiux_prompt.md` (BINDING design contract)**
- **Write: `runs/.../ideas/<idea_dir>/uiux/design_tokens.json` (color/typography system)**
- **Write: `runs/.../ideas/<idea_dir>/uiux/component_inventory.md` (required UI components)**
- **Write: `runs/.../ideas/<idea_dir>/uiux/interaction_expectations.md` (behavior specifications)**
- Update: `runs/.../ideas/<idea_dir>/meta/stage_status.json` (progress tracking)

## FRESHNESS & SOURCES (MANDATORY WEB RESEARCH)
You MUST browse current sources to avoid outdated UI patterns:

### Required Research Sources
**Design Standards** (Must consult):
- **Apple HIG**: Latest Human Interface Guidelines for iOS design patterns
- **Material Design 3**: Current Android design system requirements
- **Accessibility Guidelines**: WCAG 2.1 AA standards and platform accessibility docs
- **Category UX Patterns**: Browse 3-5 live apps in same category for current UX trends

### Research Focus Areas
1. **Navigation Patterns**: How users expect to move through apps in this category
2. **Onboarding Flows**: Current best practices for user activation
3. **Information Architecture**: How similar apps organize content and features
4. **Accessibility Standards**: Platform-specific accessibility implementations
5. **Premium Experience**: How successful apps differentiate free vs premium UX

### Citation Requirements
Document research in `stage03_research.md`:
- Design pattern sources and examples
- Accessibility requirement interpretations  
- Category-specific UX conventions
- How research influenced design decisions

## BOUNDARY ENFORCEMENT
This stage must ONLY read from:
- Current idea pack: `runs/.../ideas/<idea_dir>/`
- Global standards: `standards/mobile_app_best_practices_2026.md`

## JSON SCHEMA

```json
{
  "meta": {
    "run_id": "string",
    "idea_id": "string", 
    "idea_name": "string",
    "idea_dir": "string",
    "source_root": "string",
    "input_stage_paths": ["array of files read"],
    "boundary_path": "string"
  },
  "ux_design": {
    "user_journey": {
      "onboarding_flow": [
        {
          "step": "string",
          "screen": "string",
          "user_action": "string",
          "content": "string",
          "goal": "string"
        }
      ],
      "core_usage_flow": [
        {
          "step": "string",
          "screen": "string", 
          "user_action": "string",
          "content": "string",
          "goal": "string"
        }
      ]
    },
    "information_architecture": {
      "primary_navigation": {
        "type": "tab|drawer|stack",
        "sections": ["string"],
        "rationale": "string"
      },
      "content_hierarchy": {
        "levels": ["string"],
        "organization_principle": "string"
      }
    },
    "wireframes": {
      "home_screen": {
        "layout": "string",
        "primary_cta": "string",
        "secondary_elements": ["string"],
        "accessibility_notes": "string"
      },
      "core_feature_screens": [
        {
          "screen_name": "string",
          "purpose": "string",
          "layout": "string",
          "key_elements": ["string"],
          "accessibility_notes": "string"
        }
      ]
    },
    "interaction_patterns": {
      "primary_actions": {
        "action": "string",
        "interaction": "string",
        "feedback": "string"
      },
      "navigation_gestures": ["string"],
      "accessibility_alternatives": ["string"]
    },
    "visual_design_direction": {
      "brand_personality": "string",
      "color_strategy": {
        "primary": "string with contrast ratios",
        "secondary": "string",
        "accessibility_compliant": "boolean"
      },
      "typography": {
        "primary_font": "string",
        "scale_factor": "string for dynamic type",
        "readability_notes": "string"
      }
    },
    "accessibility_requirements": {
      "wcag_compliance": "WCAG 2.1 AA",
      "screen_reader_support": ["string"],
      "motor_accessibility": ["string"],
      "visual_accessibility": ["string"],
      "cognitive_accessibility": ["string"]
    }
  }
}
```

## EXECUTION STEPS

### Phase 1: Research & Standards Review
1. Read product specifications from stage02.json
2. Research current design standards and accessibility requirements
3. Analyze category-specific UX patterns and conventions
4. Review platform guidelines for navigation and interaction patterns

### Phase 2: Information Architecture  
5. Design primary navigation structure based on product features
6. Organize content hierarchy for optimal user task completion
7. Map user flows from onboarding through core feature usage
8. Plan premium experience differentiation

### Phase 3: Wireframe Design
9. Design home screen layout optimizing for primary user goals
10. Create wireframes for all core feature screens
11. Design interaction patterns for key user actions
12. Specify accessibility considerations for each screen

### Phase 4: Visual Direction
13. Define brand personality aligned with target users
14. Specify color strategy with accessibility compliance
15. Select typography with dynamic type support
16. Document visual design principles

### Phase 5: BINDING Design Contract Creation (MANDATORY)
17. **Analyze App Domain**: Determine visual personality from product specification
    - Paranormal/EVP → forensic, eerie, instrument-like
    - Productivity → clean, focused, efficient
    - Health/fitness → energetic, motivating, data-driven
    - Creative → expressive, flexible, inspiring

18. **Generate UI/UX Design Contract**:
    - Write `uiux/uiux_prompt.md` with exact role and design-system structure
    - Include domain-appropriate design philosophy and visual language
    - Specify cutting-edge UI patterns relevant to app category

19. **Create Design Token System**:
    - Write `uiux/design_tokens.json` with complete color palette, typography, spacing
    - Colors MUST match app domain (EVP = dark/forensic, wellness = calm/breathable)
    - Include accessibility-compliant contrast ratios

20. **Define Component Inventory**:
    - Write `uiux/component_inventory.md` listing ALL required UI components
    - Specify domain-specific components (waveforms for EVP, meters, charts)
    - Include component behavior and interaction patterns

21. **Document Interaction Expectations**:
    - Write `uiux/interaction_expectations.md` with specific behavior requirements
    - Recording states, feedback patterns, transition animations
    - Error states, loading patterns, empty states

### Phase 6: Validation & Documentation
22. Validate design against accessibility standards
23. Ensure guest-first experience design
24. Write JSON with complete UX specification
25. Document research influence on design decisions
26. Render human-readable UX specification

## STANDARDS COMPLIANCE MAPPING

### Accessibility & Design System (MANDATORY)
- **Requirement**: WCAG 2.1 AA compliance with 4.5:1 contrast ratios
- **Implementation**: All color combinations tested for contrast, alternative text specified
- **Validation**: Screen reader support documented, touch targets ≥44pt iOS/48dp Android

### Subscription UX Requirements
- **Requirement**: Clear premium value communication in UX
- **Implementation**: Premium features clearly distinguished with upgrade paths
- **Validation**: Paywall UX follows honest disclosure principles

### Platform Compliance
- **Requirement**: Follow iOS and Android design guidelines
- **Implementation**: Navigation patterns align with platform conventions
- **Validation**: Interaction patterns follow platform standards

### Inclusive Design
- **Requirement**: Support for reduced motion, large text, voice control
- **Implementation**: Alternative interactions specified for accessibility needs
- **Validation**: Design works at 200% text scaling and reduced motion settings

## SUCCESS CRITERIA
Stage 03 is complete when:
- [ ] `stage03.json` exists and validates against schema
- [ ] `stage03_research.md` documents design research and standards
- [ ] User flows designed for guest-first experience with premium upgrades
- [ ] All screens meet accessibility requirements with specific implementations
- [ ] Navigation and interaction patterns follow platform conventions
- [ ] Visual design direction supports subscription business model

## HARD FAILURE CONDITIONS
- Schema validation failure → Write `stage03_failure.md` and stop
- Accessibility requirements not met → Write `stage03_failure.md` and stop
- Design conflicts with subscription model → Write `stage03_failure.md` and stop
- Platform guideline violations → Write `stage03_failure.md` and stop
- Boundary violation (reading from wrong idea pack) → Write `stage03_failure.md` and stop

DO NOT output JSON in chat. Write all artifacts to disk and continue with Stage 04.