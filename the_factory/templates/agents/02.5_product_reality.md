# Stage 02.5: Product Reality Gate (Conceptual Validation)

## AGENT-NATIVE EXECUTION
You are Claude executing Stage 02.5 for a SPECIFIC IDEA PACK. Validate that this app concept has concrete substance and meaningful user value before UI/UX design.

## BUILD MODE VERIFICATION (CRITICAL)
Stage 02.5 can ONLY be executed via `build <IDEA_ID_OR_NAME>` command:
- Verify invocation came from build mode, not `run app factory`
- Require Stage 01-02 artifacts exist (hard-fail if missing)
- Assert this stage is building ONE SPECIFIC IDEA only
- Hard-fail if executed during batch idea generation

## PURPOSE (MANDATORY GATE)
This stage prevents conceptually empty apps from proceeding to UI/UX design.

**FORBIDDEN OUTPUTS**: Apps that are just "nice ideas" without concrete user actions
**REQUIRED OUTPUTS**: Apps with clear domain objects, user loops, and measurable value

## INPUTS
- Read: `runs/.../ideas/<idea_dir>/stages/stage02.json` (product specification)
- Read: `runs/.../ideas/<idea_dir>/meta/idea.json` (canonical idea definition)
- Read: `runs/.../ideas/<idea_dir>/meta/boundary.json` (isolation enforcement)

## OUTPUTS
- Write: `runs/.../ideas/<idea_dir>/stages/stage02.5.json` (product reality validation)
- Write: `runs/.../ideas/<idea_dir>/outputs/stage02.5_execution.md` (execution log)
- Write: `runs/.../ideas/<idea_dir>/product/core_loop.md` (user flow definition)
- Write: `runs/.../ideas/<idea_dir>/product/domain_model.json` (core objects)
- Write: `runs/.../ideas/<idea_dir>/product/mvp_scope.md` (minimum viable scope)
- Update: `runs/.../ideas/<idea_dir>/meta/stage_status.json` (progress tracking)

## PRODUCT REALITY VALIDATION (MANDATORY)

### Core Domain Objects Analysis
Extract and validate the app manipulates concrete entities:

**GOOD EXAMPLES**:
- EVP Analyzer: Sessions, Recordings, Anomalies, Analyses
- Task Manager: Tasks, Projects, Deadlines, Priorities
- Habit Tracker: Habits, Streaks, Check-ins, Goals

**BAD EXAMPLES** (FAIL BUILD):
- "Mindfulness" (too abstract)
- "Productivity" (no clear objects)
- "Wellness" (no concrete actions)

**VALIDATION RULE**: App must manipulate at least 3 concrete, user-created objects

### Complete User Loop Definition
Define ONE complete user flow from start to resolution:

**MANDATORY STRUCTURE**:
1. **Create**: User creates/initiates something concrete
2. **View**: User can see their created objects in context
3. **Interact**: User can modify, analyze, or act on objects
4. **Resolve**: User achieves measurable outcome or completion state

**EXAMPLE** (EVP Analyzer):
1. Create: Start new investigation session at location
2. View: See session list with metadata and anomaly counts
3. Interact: Record audio, analyze for EVP, tag anomalies
4. Resolve: Complete session with evidence classification

**FAILURE CONDITIONS**:
- Loop has gaps ("then something happens")
- No clear completion state
- User actions are vague or conceptual only

### MVP Scope Validation
Define minimum viable implementation that delivers real value:

**REQUIRED ELEMENTS**:
- Core objects can be created, stored, retrieved
- Primary user loop works end-to-end
- User sees immediate value after first use
- Clear success/failure states

**SCOPE BOUNDARIES**:
- List features that MUST exist for app to be functional
- Identify "nice to have" vs "must have"
- Validate scope is achievable in single build cycle

## JSON SCHEMA

```json
{
  "meta": {
    "run_id": "string",
    "idea_id": "string", 
    "idea_name": "string",
    "idea_dir": "string",
    "source_root": "string",
    "input_stage_paths": ["array of files read"],
    "boundary_path": "string"
  },
  "product_reality": {
    "domain_validation": {
      "core_objects": [
        {
          "name": "string",
          "description": "string",
          "user_actions": ["create", "view", "edit", "delete"],
          "data_structure": "object"
        }
      ],
      "object_relationships": ["string"],
      "validation_passed": "boolean",
      "failure_reason": "string|null"
    },
    "user_loop": {
      "create_step": {
        "action": "string",
        "object_created": "string",
        "user_input_required": ["string"]
      },
      "view_step": {
        "action": "string", 
        "context_provided": "string",
        "information_displayed": ["string"]
      },
      "interact_step": {
        "action": "string",
        "modifications_possible": ["string"],
        "tools_required": ["string"]
      },
      "resolve_step": {
        "action": "string",
        "completion_criteria": "string",
        "value_delivered": "string"
      },
      "loop_validation": {
        "completeness": "boolean",
        "measurable_outcome": "boolean",
        "immediate_value": "boolean"
      }
    },
    "mvp_scope": {
      "must_have_features": [
        {
          "feature": "string",
          "justification": "string",
          "complexity": "low|medium|high"
        }
      ],
      "nice_to_have_features": ["string"],
      "success_criteria": "string",
      "scope_validation": {
        "achievable": "boolean",
        "valuable": "boolean",
        "testable": "boolean"
      }
    }
  },
  "gate_result": {
    "passed": "boolean",
    "confidence_score": "number",
    "blocking_issues": ["string"],
    "recommendations": ["string"]
  }
}
```

## FAILURE CONDITIONS (HARD STOP)

Stage 02.5 MUST FAIL if:

### Conceptual Emptiness
- App concept is too abstract (no concrete objects)
- User actions are vague or philosophical
- No clear value proposition beyond "nice idea"

### Incomplete User Loop  
- Missing steps in create → view → interact → resolve
- No clear completion or success state
- User can't achieve measurable outcome

### Unachievable MVP Scope
- Scope too broad for single build cycle
- Core features require complex external integrations
- No immediate user value after first use

### Domain Mismatch
- App domain doesn't match Stage 01 market research
- Target user unclear or contradictory
- Value proposition doesn't align with identified market need

## BOUNDARY ENFORCEMENT
This stage must ONLY read from:
- Current idea pack: `runs/.../ideas/<idea_dir>/`
- No cross-contamination with other ideas or runs

## EXECUTION STEPS

1. **Load Product Specification**: Read Stage 02 JSON for product details
2. **Extract Domain Objects**: Identify concrete entities user will manipulate
3. **Map User Loop**: Define complete create → view → interact → resolve flow
4. **Validate MVP Scope**: Confirm minimum features deliver real value
5. **Generate Artifacts**: Write domain model, user loop, and MVP scope to disk
6. **Pass/Fail Decision**: Determine if app concept has sufficient substance
7. **Write Stage JSON**: Document validation results and gate decision

## QUALITY GATE ENFORCEMENT

**PASS CRITERIA**:
- At least 3 concrete domain objects identified
- Complete user loop with measurable outcome
- MVP scope achievable and valuable
- Clear alignment with market research

**FAIL CRITERIA**:
- Abstract concepts without concrete objects
- Incomplete or vague user loop
- Unachievable scope or unclear value
- Domain mismatch with target market

If ANY fail criteria are met, Stage 02.5 MUST fail the build and prevent progression to UI/UX design.